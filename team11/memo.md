全体フロー

| ステップ                                         | 処理内容                                                                                                                                                                | 目的・やっていること（わかりやすく）                                                      |
| -------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------- |
| **0) セットアップ**                                | - 必要なライブラリ（LightGBM, pandasなど）をインストール・読み込み<br>- 乱数を固定                                                                                                               | 環境準備。どのPCでも同じ結果が出るようにする。                                                |
| **1) サンプルデータ作成**                             | - 架空の企業データ（3000件）をランダムに生成<br>- 「エリア」「業界」「企業規模」「競合」「失注理由テキスト」を作る<br>- 各チームの得意分野（例：チームAは製造業が得意）を仮定<br>- 得意領域なら奪回しやすくなるようにスコア補正<br>- 最後に `winback`（奪回成功=1／失敗=0）を確率で決める | 実際の顧客データが無いので「仮想データ」を作って、AIモデルの動作を確認できるようにする。<br>営業の“取りやすいパターン”を再現している。 |
| **2) 前処理**                                   | - 文字データ（カテゴリ列）を数値に変換（LabelEncoder）<br>- 失注理由テキストを **TF-IDF** で数値化（文字n-gramで日本語OK）<br>- すべての特徴を結合して訓練データを作成<br>- 訓練用とテスト用に分割（8:2）                                    | 機械学習は文字を直接扱えないため、AIが読める数値形式に変換。<br>TF-IDFは「よく出るけど特徴的な言葉」に重みをつけて表現する方法。  |
| **3) LightGBM学習（callback形式 early_stopping）** | - LightGBMモデルを作成し、訓練データで学習<br>- 評価指標（AUC）を指定<br>- **early_stopping**：精度が上がらなくなったら自動で止める<br>- **log_evaluation**：進捗を定期的に表示                                           | LightGBMは「奪回できる確率」を予測するAIモデル。<br>自動で特徴の重要度を判断して、最適なルールを見つけてくれる。         |
| **4) 評価**                                    | - テストデータに対して予測を実施<br>- AUC（判別力）を計算<br>- Precision（精度）やRecall（再現率）をレポートで確認                                                                                           | モデルがどのくらい「当たっているか」を数値でチェック。<br>AUCが0.7以上なら実務でも十分活用可能。                   |
| **5) チームごとの「取りやすさランク」**                      | - 予測確率（`pred_proba`）を全件計算<br>- 各チームで奪回確率の高い上位100件を抽出<br>- その合計値を「期待奪回数（expected_winbacks）」として集計<br>- ランク順に並べる                                                       | 「どのチームが取りやすい案件を多く持っているか」を見える化。<br>奪回確率の合計＝今期取れそうな件数の期待値。                |
| **6) 奪回確率上位企業リスト（チーム別）**                     | - チームごとに確率上位5社を抽出<br>- 顧客名・エリア・業界・失注理由を表示                                                                                                                           | 各チームが「今アプローチすべき企業」をリストアップ。<br>営業活動の優先順位づけができる。                          |
